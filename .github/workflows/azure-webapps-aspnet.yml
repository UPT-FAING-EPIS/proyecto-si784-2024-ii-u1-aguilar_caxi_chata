
name: Deploy ASP.NET Project to Azure

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

# Definición de trabajos (jobs) en el workflow
jobs:
  build:
    runs-on: windows-latest

    steps:
    # 1. Habilitar rutas largas en Git
    - name: Enable long paths in Git
      run: git config --system core.longpaths true

    # 2. Checkout del repositorio
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        path: './repo'

    # 3. Verificar la estructura del repositorio y el perfil de publicación
    - name: Verify Publish Profile Path
      run: ls -R ./repo/Proyecto_RUMI/Proyecto_Web2_Aguilar_Chino_Gonzales_Perez/Properties/PublishProfiles

    # 4. Restaurar paquetes NuGet
    - name: Restore NuGet packages
      run: nuget restore ./repo/Proyecto_RUMI/Proyecto_Web2_Aguilar_Chino_Gonzales_Perez.sln

    # 5. Compilar con MSBuild
    - name: Build with MSBuild
      run: msbuild ./repo/Proyecto_RUMI/Proyecto_Web2_Aguilar_Chino_Gonzales_Perez.sln /p:Configuration=Release

    # 6. Publicar usando MSBuild y especificar el perfil de publicación
    - name: Publish using MSBuild
      run: msbuild ./repo/Proyecto_RUMI/Proyecto_Web2_Aguilar_Chino_Gonzales_Perez.sln /p:Configuration=Release /p:DeployOnBuild=true /p:PublishProfile=Properties/PublishProfiles/CalidadRumi-WebDeploy.pubxml /p:WebPublishMethod=Package /p:PackageLocation="$(System.DefaultWorkingDirectory)/publish_output" /verbosity:detailed

